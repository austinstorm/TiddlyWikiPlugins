/***
|''Name''|RewindPlugin|
|''Description''|Renders $target message with $target link to the last tiddler you came from|
|''Author''|Tobias Beer|
|''Version''|0.8.0|
|''Documentation:''|http://rewind.tiddlyspace.com/|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/RewindPlugin.min.js|
|''License''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion''|2.5.3|
/%***/
(function(e){config.extensions.rewind={insertAt:".subtitle",insertAfter:true,noMessageForSelf:true,onlyPrettyLinks:false,msgClass:"",tplRewindMessage:"« go back to [[%0]]%1",txtRewindPrettyLink:" where you clicked [[%0|%1]]",handleLink:function(t,n,r){var i,s,o,u=!r;if(u){t=this.getAttribute("tiddlylink");n=this.getAttribute("linkNo");r=story.displayTiddler(null,t)}o=e("a.tiddlyLink",r);if(u){n=e(o[n]);ensureVisible(n[0]);n.fadeOut(400).fadeIn(300).fadeOut(200).fadeIn(300)}else{for(i=0;i<o.length;i++)if(n==o[i])return i}}};onClickTiddlerLink_Rewind=onClickTiddlerLink;onClickTiddlerLink=function(t){onClickTiddlerLink_Rewind.apply(this,arguments);var n,r,i=config.extensions.rewind,s=resolveTarget(t||window.event),o=e(s).text(),u=s.getAttribute("tiddlyLink"),a=o!=u,f=e(story.getTiddler(u)),l=story.findContainingTiddler(s),c=l?l.getAttribute("tiddler"):"",h=e(i.insertAt,f);if(i.noMessageForSelf&&c==u||i.onlyPrettyLinks&&!a||e(s).closest(".rewind_message")[0]||!c||h.length==0)return;n=e(".rewind_message",f);if(n.length){n.empty()}else{n=e('<span class="rewind_message '+i.msgClass+'"/>');i.insertAfter?h.after(n):h.before(n)}wikify(i.tplRewindMessage.format([c,a?i.txtRewindPrettyLink.format([o,c]):"",o]),n[0]);e("a.tiddlyLink",n).each(function(t,n){var n,r=e(n);if(r.text()!=r.attr("tiddlyLink")){r.attr({linkNo:i.handleLink(r.text(),s,l)}).click(i.handleLink)}})};config.shadowTiddlers.StyleSheetRewind=store.getTiddlerText("RewindPlugin##CSS");store.addNotification("StyleSheetRewind",refreshStyles)})(jQuery)
//%/
//{{{
/*
!CSS
.rewind_message{
    display:block;
    background-color:[[ColorPalette::TertiaryPale]];
    margin:3px 0 10px 0;
    padding:3px;
}
!END
*/
//}}}