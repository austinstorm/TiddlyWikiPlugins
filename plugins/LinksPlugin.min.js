/***
|''Name''|LinksPlugin|
|''Author''|[[Tobias Beer|http://tobibeer.tiddlyspace.com]]|
|''Description''|outputs links in tiddlers|
|''Documentation''|http://links.tiddlyspace.com|
|''Version''|0.5.1 (2013-10-01)|
|''~CoreVersion''|2.5.2|
|''License''|Creative Commons 3.0|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/LinksPlugin.min.js|
***/
// /%
(function(e){var t=config.macros.links={defaults:{fmtTiddler:"\n;[[%0]]",fmtInternal:"[[%0|%1]]",fmtInternalItem:"\n:%0%1",fmtInternalPlus:"\n:*[[%0]]",fmtExternal:"[[%0|%1]]",fmtExternalItem:"\n:%0%1",fmtExternalPlus:"\n:*%0",fmtSeparator:", ",classTiddler:"tiddlerLinks",external:true,internal:true,listfiltr:true,sort:"title",exclude:"excludeLists excludeSearch systemConfig",filter:"",title:"",link:"",tiddler:""},handler:function(n,r,i,s,o,u){t.refresh(e('<span class="linkIndex"/>').appendTo(n).attr({refresh:"macro",macroName:"links",params:o})[0],o)},refresh:function(n,r){e(n).empty();var i="",s,o,u={},o=[],a=r.parseParams("anon",null,true),f=a[0]["anon"]||[];e.each(t.defaults,function(e,t){u[e]=getParam(a,e,t);if(f.contains(e))u[e]=true});["external","internal","listfiltr"].map(function(e){u[e]="true"==u[e].toString()});if(u.tiddler){o.push(store.getTiddler(u.tiddler))}else{o=u.filter?store.filterTiddlers(u.filter):store.getTiddlers(u.sort)}u.exclude=u.exclude.readBracketedList();s=u.fmtSeparator;u.tids={};o.map(function(e){if(!(u.exclude.contains(e.title)||u.exclude.containsAny(e.tags))){t.getLinks(u,e)}});e.each(u.tids,function(t,n){i+=u.fmtTiddler.format([t]);e.each(n,function(e,t){var n,r=0,o,a,f="",l=config.formatterHelpers.isExternalLink(e);for(a=0;a<t.length;a++){o=t[a];if(e==o&&(l&&u.fmtExternalPlus||!l&&u.fmtInternalPlus))continue;r++;f+=u[l?"fmtExternal":"fmtInternal"].format([o,e])+(a<t.length-1?s:"")}n=f.length-s.length;if(f.lastIndexOf(s)==n)f=f.substr(0,n);i+=u[l?"fmtExternalItem":"fmtInternalItem"].format([r?f:u[l?"fmtExternal":"fmtInternal"].format([e,e]),u.fmtExternalPlus||u.fmtInternalPlus?!r?"":u[l?"fmtExternalPlus":"fmtInternalPlus"].format([e]):e])})});wikify("{{listfiltrLinks"+(u.tiddler?" "+u.classTiddler:"")+"{"+i+"\n}}}"+(u.listfiltr&&config.macros.listfiltr?"<<listfiltr>>":""),n)},getLinks:function(e,t){var n,r,i,s,o,u=config.textPrimitives.tiddlerAnyLinkRegExp,a=t.text.replace(/\/%((?:.|\n)*?)%\//g,"").replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").replace(/"""((?:.|\n)*?)"""/g,"").replace(/<<((?:.|\n)*?)\>\>/g,"").replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").replace(/<script((?:.|\n)*?)<\/script\>/g,"")+" ",f=function(t,n,r){isExternal=config.formatterHelpers.isExternalLink(n);if(e.title&&r.toLowerCase().indexOf(e.title.toLowerCase())<0||e.link&&n.toLowerCase().indexOf(e.link.toLowerCase())<0||!e.internal&&!isExternal||!e.external&&isExternal)return;var i,s=e.tids[t];if(!s)s=e.tids[t]={};i=s[n];if(!i)i=s[n]=[];i.pushUnique(r)};u.lastIndex=0;r=u.exec(a);while(r){n=u.lastIndex;if(r[1]){if(r.index>0){o=new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");o.lastIndex=r.index-1;s=o.exec(a);if(s.index!=r.index-1)f(t.title,r[1],r[1])}else{f(t.title,r[1],r[1])}}else if(r[2])f(t.title,r[3],r[2]);else if(r[4])f(t.title,r[4],r[4]);else if(r[0])f(t.title,r[0],r[0]);u.lastIndex=n;r=u.exec(a)}}};config.shadowTiddlers["StyleSheetLinksPlugin"]="/*{{{*/\n"+".tiddlerLinks > dl > dt,\n"+".tiddlerLinks > .lf-list > dl > dt\n"+"{display:none;}\n"+".tiddlerLinks > dl > dd,\n"+".tiddlerLinks > .lf-list > dl > dd\n"+"{margin:0;}\n"+".tiddlerLinks > dl > dd:before,\n"+".tiddlerLinks > .lf-list > dl > dd:before\n"+'{content:"";}\n'+"/*}}}*/";store.addNotification("StyleSheetLinksPlugin",refreshStyles)})(jQuery)
// %/