/***
|''Name''|RandomTiddlersMacro|
|''Description''|returns a list of x out of y random tiddlers, optionally...<br>-> having a certain tag<br>-> returning a tiddler section, slice or field value|
|''Documentation''|http://tobibeer.tiddlyspace.com/#RandomTiddlers|
|''Author''|Tobias Beer|
|''Version''|1.0.4 (2012-07-14)|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/RandomTiddlersMacro.min.js|
|''License''|[[Creative Commons Attribution-Share Alike 3.0|http://creativecommons.org/licenses/by-sa/3.0/]]|
|''~CoreVersion''|2.2|
/%***/
config.macros.randomTiddlers={config:"RandomTiddlersConfig",txtConfirm1:"Please provide a name for the output tiddler:",txtConfirm2:'The tiddler "%0" already exists! Please provide another name for the output tiddler or enter "YES" to overwrite the tiddler "%0":',txtSavedTo:"The following list was saved to tiddler [[%0]]%1...\n",txtOpenStory:" (<<openStory [[%0]]>>)",txtAbortAt:"YES",txtNoConfig:'@@color:red;The configuration tiddler called "%0" could not be found!@@',handler:function(e,t,n,r,i,s){var o=n[0]||this.config;if(!store.getTiddler(o)){wikify(this.txtNoConfig.format([o]),e);return}var u=[],a,f=0,l=0,c="",h,p,d,v,m,g,y=[],b,w=parseInt(store.getTiddlerText(o+"::max"))||10,E=parseInt(store.getTiddlerText(o+"::sample"))||50,S=store.getTiddlerText(o+"::tagged"),x=store.getTiddlerText(o+"::exclude"),T=store.getTiddlerText(o+"::content"),N=store.getTiddlerText(o+"::type"),C=store.getTiddlerText(o+"::required")=="yes",k=store.getTiddlerText(o+"::saveTo"),L=store.getTiddlerText(o+"::saveWithTags")||"",A=store.getTiddlerText(o+"::sort"),O=store.getTiddlerText(o+"::dateformat"),M=store.getTiddlerText(o),_=store.getTiddlers(A);if(S)S=S.readBracketedList();if(x)x=x.readBracketedList();h=M.indexOf("!Template\n");M=M.substr(h+10)+"\n";if(M.substr(0,4)=="{{{\n"&&M.substr(M.length-5,4)=="\n}}}"){M=M.substr(3,M.length-8)}N=N?N.toLowerCase():"";N=N=="field"?"f":N=="slice"?"::":"##";if(!S)u=_;else{p=_.length;while(p>0){p--;v=_[p];m=v.tags;if(m&&m.containsAny(S)&&(!x||!m.containsAny(x))){if(N=="f")g=store.getValue(v,T);else g=store.getTiddlerText(v.title+N+T);if(!C||C&&g){u.push(_[p]);y[v.title]=g;f++}}if(f>=E)break}}while(u.length>0&&l<w){l++;f=Math.floor(Math.random()*u.length);a=u[f][A].formatString(O);c+=M.format([u[f].title,T,y[u[f].title],a,u[f].modifier,u[f].tags],l);u.splice(f,1)}c=c.substr(1);if(k){d=prompt(this.txtConfirm1,k);if(d&&d!=k){while(store.getTiddler(d)&&d!=this.txtAbortAt){b=d;d=prompt(this.txtConfirm2.format([d]))}}if(d==this.txtAbortAt)d=b;if(d){store.saveTiddler(d,d,c,config.options.txtUserName,new Date,L.readBracketedList(),merge({},config.defaultCustomFields));wikify(this.txtSavedTo.format([d,config.macros.openStory?this.txtOpenStory.format([d]):""]),e);if(config.options.chkAutoSave)autoSaveChanges(null,[d]);}}wikify(c,e)}}
//%/