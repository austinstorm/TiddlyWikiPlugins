/***
|''Name''|SimpleTreePlugin|
|''Description''|Creates a simple expandable / collapsible tree|
|''Documentation''|http://simpletree.tiddlyspace.com|
|''Version''|1.0.0 (2013-10-08)|
|''Core''|2.5.2|
|''Author''|Tobias Beer|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/SimpleTreePlugin.min.js|
/%***/
(function(e){var t=config.macros.simpletree={bulletSubNone:"-",bulletSubClosed:"+",bulletSubOpen:">",showLinksAsBlocks:false,collapseSiblings:true,slideOpenClose:false,slideDuration:"400",txtAltClick:"ALT+cLick or double click a list bullet to expand all...",handler:function(n,r,i,s,o,u){var a,f,l,c,h="",p=o.parseParams("st",null,true),d=getParam(p,"class",""),v=i.contains("block")||this.showLinksAsBlocks,m=i.contains("slide")||this.slideOpenClose,g=this.slideDuration,y=getParam(p,"bullets",this.bulletSubNone+"|"+this.bulletSubClosed+"|"+this.bulletSubOpen).split("|"),b=i.contains("collapse")||this.collapseSiblings&&!i.contains("nocollapse"),w=getParam(p,"css","")+store.getTiddlerText(getParam(p,"template","")),E="st-"+(new Date).formatString("YYYYMMDDhhmmss")+Math.random().toString().substr(6);f=e(n).children().last();while(f.is("br"))f=f.prev();f.wrapAll('<div class="st-tree '+E+'"/>');f=e("."+E).attr("title",this.txtAltClick);f.dblclick(function(){return false});l=(y[0]||"").trim();a=(y[1]||"").trim();c=(y[2]||"").trim();e('<span class="st-bullets" style="display:none;">'+'<span class="st-bullet-none">'+l+"</span>"+'<span class="st-bullet-closed">'+a+"</span>"+'<span class="st-bullet-open">'+c+"</span>").prependTo(f);if(d)f.addClass(d);e("li",f).filter(function(){return e(this).parent().is("ul")}).prepend(e('<span class="st-bullet"/>'));e(".st-bullet",f).dblclick(function(){t.toggleAll(f)});e("li:has(> ul, > span > ul, > ol, > span > ol)",f).addClass("st-closed").find(".st-bullet").html(a);e("li:not(:has(> ul, > span > ul, > ol, > span > ol))",f).addClass("st-no-childs").find(".st-bullet").html(l);e("a",f).filter(function(){return e(this).parent().is("li")&&e(this).text().replace(/\s/,"")==e(this).parent().clone().children(":not(a)").remove().end().text().replace(/\s/,"")}).addClass(v?"st-block":"st-noblock");e("ol > li").each(function(){e(this).contents().wrapAll('<span class="st-ol-wrap"/>')});e("li",f).click(function(n){var r=e(this),n=n||window.event,i=e(n.target),s=e(this).closest(".st-tree"),o=i.is("a")?i:i.closest("a");if(o.is("a")){if(o.is(".internalLink")){if(v)o.closest("li").is(".st-closed").removeClass("st-closed").addClass("st-open").find("st-bullet:first").html(c);return false}else{if(o.is(".externalLink")||(o.attr("href")||"").indexOf("javascript:")!=0&&o.attr("href")!="#"){window.open(o.attr("href"));return false}}}if(n.altKey){t.toggleAll(s);return t.show(r)}if(s.hasClass("st-all")){s.removeClass("st-all");e("ul, ol",s).css("display","");e(".st-bullet",s).each(function(){var t=e(this),n=t.parent();if(n.is(":not(.st-no-childs)"))t.html(n.is(".st-open")?c:a)});r.parents().each(function(){var t=e(this);if(t.is(".st-tree"))return;if(t.is("li")){t.removeClass("st-closed").addClass("st-open").find(".st-bullet:first").html(c);t.siblings(".st-open").removeClass("st-open").addClass("st-closed").find(".st-bullet:first").html(a)}});return t.show(r)}if(r.hasClass("st-no-childs"))return false;if(r.hasClass("st-closed")){if(b){r.siblings(':not(".st-no-childs")').removeClass("st-open").addClass("st-closed").find(".st-bullet:first").html(a);if(m)r.siblings().each(function(){e(this).find("ul, ol").first().css("display","none")})}if(m)r.children("ul,ol").slideDown(g,function(){e(this).css("display","")});r.removeClass("st-closed").addClass("st-open").find(".st-bullet:first").html(c)}else{r.removeClass("st-open").addClass("st-closed").find(".st-bullet:first").html(a);if(m)r.children("ul,ol").slideUp(g,function(){e(this).css("display","")})}return t.show(r)});d="";e.each(w.split("}"),function(t,n){var r=n.split("{");if(!r[1])return;e.each(r[0].split(","),function(e,t){d+="."+E+" "+t+","});d=d.substr(0,d.length-1)+"{"+r[1]+"}"});setStylesheet(d,"StyleSheet"+E)},show:function(e){window.scrollTo(0,ensureVisible(e[0]));return false},toggleAll:function(t){t.each(function(){var t=e(this);if(!t.hasClass("st-all")){t.addClass("st-all");e(".st-closed",t).removeClass("st-closed").addClass("st-open").find(".st-bullet:first").empty().append(t.find(".st-bullet-open").first().clone());e("ul, ol",t).css("display","")}else{t.removeClass("st-all");var n=e(".st-open",t).removeClass("st-open").addClass("st-closed").find(".st-bullet:first").empty().append(t.find(".st-bullet-closed").first().clone());e("li ul, li ol",t).css("display","none")}})}};config.shadowTiddlers.StyleSheetSimpleTree="/*{{{*/\n"+".st-tree ul {\n	list-style-type:none;\n	margin-left:7px !important;\n	padding-left:0 !important;\n}\n"+".st-tree ol {\n	margin-left:5px !important;\n	padding-left:0 !important;\n}\n"+".st-tree li {\n	border:1px solid transparent;\n	border-left: 1px solid #eee;\n	padding:3px 0 3px 12px;\n	cursor:pointer;\n}\n"+".st-tree li:hover {\n	border-color:#eee;\n	border-left-color:#ddd;\n	background:#f3f3f3;\n}\n"+".st-tree ul ul:hover li:hover {\n	border-right-color:transparent;\n	background:#f5f5f5}\n"+".st-tree ul ul ul:hover li:hover {\n	background:#f7f7f7}\n"+".st-tree ul ul ul ul:hover li:hover {\n	background:#f9f9f9}\n"+".st-tree ul:hover ul li {\n	background:#fff;\n}\n"+".st-bullet {\n	display:inline-block;\n	width:18px;\n	margin-left:-14px;\n	padding-left:8px;\n	background-color:transparent;\n	color:#ccc;\n}\n"+".st-tree li:hover > .st-bullet {\n	color:#666;\n}\n"+".st-closed > ul, .st-closed > span > ul, .st-closed > ol, .st-closed > span > ol {\n	display:none;\n}\n"+".st-tree ol {\n	list-style-position:inside;\n}\n"+".st-open > ul,.st-open > ol {\n	display:block;\n}\n"+".st-closed ul, .st-open ul, .st-closed ol,.st-open ol {\n	margin:3px 0 3px 10px;\n}\n"+".st-block {\n	display:inline-block;\n	width:85%;\n	padding-left:7px;margin-left:-7px;\n}\n"+".st-noblock {\n	padding: 1px 20px 1px 3px;margin-left:-3px;\n}\n"+".st-tree li.st-no-childs, .st-tree dd, .st-tree div {\n	cursor:default;\n}\n"+".st-tree li div {\n	padding-left:10px;\n}\n"+".st-tree ul:hover li.st-closed > .st-bullet {\n	color:#BBB;\n}\n"+".st-all .st-closed ul,.st-all .st-closed ol {\n	display:block;\n}\n"+".st-tree +br {\n	display:none;\n}\n"+"/*}}}*/";store.addNotification("StyleSheetSimpleTree",refreshStyles)})(jQuery)
//%/