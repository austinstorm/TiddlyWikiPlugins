/***
|''Name''|UntaggedPlugin|
|''Author''|[[Tobias Beer|http://tobibeer.tiddlyspace.com]]|
|''Description''|provides an """<<untagged>>""" macro<br>adds an untagged button to the tags tab<br>allows to hide (empty) tags / tagging|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/UntaggedPlugin.min.js|
|''Documentation''|http://untagged.tiddlyspace.com|
|''Version''|1.0.6 (2013-10-06)|
|''~CoreVersion''|2.5.2|
|''License''|Creative Commons 3.0|
<<option chkShowUntagged>> chkShowUntagged
<<option chkShowUntaggedShadows>> chkShowUntaggedShadows
<<option chkHideEmptyTags>> chkHideEmptyTags
<<option chkHideEmptyTagging>> chkHideEmptyTagging
***/
// /%
(function(e){if(!config.options.chkShowUntagged){config.options.chkShowUntagged=true}if(!config.options.chkShowUntaggedShadows){config.options.chkShowUntaggedShadows=false}if(!config.options.chkHideEmptyTags){config.options.chkHideEmptyTags=true}if(!config.options.chkHideEmptyTagging){config.options.chkHideEmptyTagging=true}merge(config.views.wikified.tag,{untaggedButton:"untagged (%0)",untaggedTooltip:"Show untagged tiddlers...",untaggedListTitle:"Untagged tiddlers:",untaggedNone:"There are no untagged tiddlers...",openUntagged:"Open '%0'"});var t=config.views.wikified.tag;var n=config.macros.untagged={selectorTags:".tagged, .tidTags, .infoTags",selectorTagging:".tagging, .infoTagging",noTagsWhenTagged:"no-tags",noTaggingWhenTagged:"no-tagging",untaggedTiddler:"untagged",hideTags:"excludeLists excludeMissing excludePublisher excludeSearch no-tags no-tagging noLinkify",hideTagsReadOnly:"systemConfig",handler:function(e,t,r,i,s,o){n.refresh(e,s)},refresh:function(r,i){var s,o=[],u,a=i.parseParams("anon",null,true),f=a[0]["anon"]||[],l=f.contains("list"),c=e(r).attr("macroName")=="untagged",h=e(r),p=c?h.parent()[0]:r;if(c)h.hide();store.getTiddlers("title").map(function(e){if(!config.options.chkShowUntaggedShadows&&config.shadowTiddlers[e.title])return true;if(!e.tags||!e.tags.length)o.push(e)});s=e(l?createTiddlyElement(p,"ul"):createTiddlyButton(p,t.untaggedButton.format([o.length]),t.untaggedTooltip,n.showList,"tiddlyLink untagged")).data("tids",o).attr({tiddlyLink:n.untaggedTiddler?n.untaggedTiddler:"",refresh:"macro",macroName:"untagged",params:i});if(l)n.showList(null,s[0]);else if(f.contains("alltags")){s.appendTo(e("<li/>").appendTo(s.prev()))}if(c){s.insertAfter(h);h.remove()}},showList:function(r,i){var s,o=r||window.event,u=e(i?i:this).data("tids"),a=i?i:Popup.create(this),f=e(a);f.addClass("taggedTiddlerList untaggedTiddlerList");if(u.length>0){if(i){createTiddlyElement(a,"li",null,"listTitle",t.untaggedListTitle)}else if(!config.options.chkSinglePageMode){createTiddlyButton(createTiddlyElement(a,"li"),t.openAllText.format([t.untaggedButton]),t.untaggedTooltip,n.openAll);createTiddlyElement(createTiddlyElement(a,"li",null,"listBreak"),"div")}u.map(function(e){createTiddlyLink(createTiddlyElement(a,"li"),e.title,true)});if(n.untaggedTiddler&&!i){createTiddlyElement(createTiddlyElement(a,"li",null,"listBreak"),"div");s=createTiddlyLink(createTiddlyElement(a,"li"),n.untaggedTiddler,false);createTiddlyText(s,t.openUntagged.format([n.untaggedTiddler]))}}else{createTiddlyElement(a,"li",null,"disabled",t.untaggedNone)}f.data("tids",u);if(!i){Popup.show();o.cancelBubble=true;if(o.stopPropagation)o.stopPropagation();return false}},openAll:function(){story.displayTiddlers(this,e(this).closest(".taggedTiddlerList").data("tids"));return false},hide:function(t,r){var i=n.hideTags;hideR=n.hideTagsReadOnly;if(i||hideR){i=i.readBracketedList();hideR=hideR.readBracketedList();e(".button, .tiddlyLink",t).each(function(){var t=e(this),n=t.attr("tag");if(i.contains(n)||readOnly&&hideR.contains(n)){t.hide();t=t.parent();if(t.is("li")&&t.children().length<2)t.hide()}});if(config.options["chkHideEmpty"+r]&&!e(".button, .tiddlyLink",t).filter(":visible").length){t.remove()}}}};config.shadowTiddlers.StyleSheetUntagged="/*{{{*/\n"+".untagged {color:[[ColorPalette::TertiaryDark]];}\n"+"/*}}}*/";store.addNotification("StyleSheetUntagged",refreshStyles);config.macros.allTags.handlerUNTAGGED=config.macros.allTags.handler;config.macros.allTags.handler=function(t,r,i){config.macros.allTags.handlerUNTAGGED.apply(this,arguments);n.hide(e(t).last());if(config.options.chkShowUntagged){wikify("<<untagged alltags>>",t)}};config.macros.tags.handlerUNTAGGED=config.macros.tags.handler;config.macros.tags.handler=function(t,r,i,s,o,u){config.macros.tags.handlerUNTAGGED.apply(this,arguments);n.hide(e(t).last(),"Tags")};Story.prototype.displayTiddlerUNTAGGED=Story.prototype.displayTiddler;Story.prototype.displayTiddler=function(t,r,i,s,o,u,a,f){var l=Story.prototype.displayTiddlerUNTAGGED.apply(this,arguments),c=r instanceof Tiddler?r.title:r,h=store.getTiddler(c);if(h&&h.tags&&h.tags.containsAny(n.noTagsWhenTagged.readBracketedList())||config.options.chkHideEmptyTags&&e(n.selectorTags,l).find("a:visible").length==0){e(n.selectorTags,l).hide()}if(h&&h.tags&&h.tags.containsAny(n.noTaggingWhenTagged.readBracketedList())||config.options.chkHideEmptyTagging&&e(n.selectorTagging,l).find("a:visible").length==0){e(n.selectorTagging,l).hide()}}})(jQuery)
// %/