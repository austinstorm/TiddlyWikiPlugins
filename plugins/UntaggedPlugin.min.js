/***
|''Name''|UntaggedPlugin|
|''Author''|[[Tobias Beer|http://tobibeer.tiddlyspace.com]]|
|''Description''|provides an """<<untagged>>""" macro<br>adds an untagged button to the tags tab<br>allows to hide (empty) tags / tagging|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/UntaggedPlugin.min.js|
|''Documentation''|http://untagged.tiddlyspace.com|
|''Version''|1.0.8 (2013-10-08)|
|''~CoreVersion''|2.5.2|
|''License''|Creative Commons 3.0|
<<option chkShowUntagged>> chkShowUntagged
<<option chkShowUntaggedShadows>> chkShowUntaggedShadows
<<option chkHideEmptyTags>> chkHideEmptyTags
<<option chkHideEmptyTagging>> chkHideEmptyTagging
***/
// /%
(function(e){var t=config.options;["chkShowUntagged","chkShowUntaggedShadows-","chkHideEmptyTags","chkHideEmptyTagging"].map(function(e){e=e.split("-");if(undefined==t[e[0]])t[e[0]]=!e[1]});merge(config.views.wikified.tag,{untaggedButton:"untagged (%0)",untaggedTooltip:"Show untagged tiddlers...",untaggedListTitle:"Untagged tiddlers:",untaggedNone:"There are no untagged tiddlers...",openUntagged:"Open '%0'"});var n=config.views.wikified.tag;var r=config.macros.untagged={selectorTags:".tagged, .tidTags, .infoTags",selectorTagging:".tagging, .infoTagging",noTagsWhenTagged:"no-tags",noTaggingWhenTagged:"no-tagging",untaggedTiddler:"untagged",hideTags:"excludeLists excludeMissing excludePublisher excludeSearch no-tags no-tagging noLinkify",hideTagsReadOnly:"systemConfig",handler:function(e,t,n,i,s,o){r.refresh(e,s)},refresh:function(i,s){var o,u=[],a,f=s.parseParams("anon",null,true),l=f[0]["anon"]||[],c=l.contains("list"),h=e(i).attr("macroName")=="untagged",p=e(i),d=h?p.parent()[0]:i;if(h)p.hide();store.getTiddlers("title").map(function(e){if(!t.chkShowUntaggedShadows&&config.shadowTiddlers[e.title])return true;if(!e.tags||!e.tags.length)u.push(e)});o=e(c?createTiddlyElement(d,"ul"):createTiddlyButton(d,n.untaggedButton.format([u.length]),n.untaggedTooltip,r.showList,"tiddlyLink untagged")).data("tids",u).attr({tiddlyLink:r.untaggedTiddler?r.untaggedTiddler:"",refresh:"macro",macroName:"untagged",params:s});if(c)r.showList(null,o[0]);else if(l.contains("alltags")){o.appendTo(e("<li/>").appendTo(o.prev()))}if(h){o.insertAfter(p);p.remove()}},showList:function(i,s){var o,u=i||window.event,a=e(s?s:this).data("tids"),f=s?s:Popup.create(this),l=e(f);l.addClass("taggedTiddlerList untaggedTiddlerList");if(a.length>0){if(s){createTiddlyElement(f,"li",null,"listTitle",n.untaggedListTitle)}else if(!t.chkSinglePageMode){createTiddlyButton(createTiddlyElement(f,"li"),n.openAllText.format([n.untaggedButton]),n.untaggedTooltip,r.openAll);createTiddlyElement(createTiddlyElement(f,"li",null,"listBreak"),"div")}a.map(function(e){createTiddlyLink(createTiddlyElement(f,"li"),e.title,true)});if(r.untaggedTiddler&&!s){createTiddlyElement(createTiddlyElement(f,"li",null,"listBreak"),"div");o=createTiddlyLink(createTiddlyElement(f,"li"),r.untaggedTiddler,false);createTiddlyText(o,n.openUntagged.format([r.untaggedTiddler]))}}else{createTiddlyElement(f,"li",null,"disabled",n.untaggedNone)}l.data("tids",a);if(!s){Popup.show();u.cancelBubble=true;if(u.stopPropagation)u.stopPropagation();return false}},openAll:function(){story.displayTiddlers(this,e(this).closest(".taggedTiddlerList").data("tids"));return false},hide:function(n,i){var s=r.hideTags;hideR=r.hideTagsReadOnly;if(s||hideR){s=s.readBracketedList();hideR=hideR.readBracketedList();e(".button, .tiddlyLink",n).each(function(){var t=e(this),n=t.attr("tag");if(s.contains(n)||readOnly&&hideR.contains(n)){t.hide();t=t.parent();if(t.is("li")&&t.children().length<2)t.hide()}});if(t["chkHideEmpty"+i]&&!e(".button, .tiddlyLink",n).filter(":visible").length){n.remove()}}}};config.shadowTiddlers.StyleSheetUntagged="/*{{{*/\n"+".untagged {color:[[ColorPalette::TertiaryDark]];}\n"+"/*}}}*/";store.addNotification("StyleSheetUntagged",refreshStyles);config.macros.allTags.handlerUNTAGGED=config.macros.allTags.handler;config.macros.allTags.handler=function(n,i,s){config.macros.allTags.handlerUNTAGGED.apply(this,arguments);r.hide(e(n).last());if(t.chkShowUntagged){wikify("<<untagged alltags>>",n)}};config.macros.tags.handlerUNTAGGED=config.macros.tags.handler;config.macros.tags.handler=function(t,n,i,s,o,u){config.macros.tags.handlerUNTAGGED.apply(this,arguments);r.hide(e(t).last(),"Tags")};Story.prototype.displayTiddlerUNTAGGED=Story.prototype.displayTiddler;Story.prototype.displayTiddler=function(n,i,s,o,u,a,f,l){var c=Story.prototype.displayTiddlerUNTAGGED.apply(this,arguments),h=i instanceof Tiddler?i.title:i,p=store.getTiddler(h);if(p&&p.tags&&p.tags.containsAny(r.noTagsWhenTagged.readBracketedList())||t.chkHideEmptyTags&&e(r.selectorTags,c).find("a:visible").length==0){e(r.selectorTags,c).hide()}if(p&&p.tags&&p.tags.containsAny(r.noTaggingWhenTagged.readBracketedList())||t.chkHideEmptyTagging&&e(r.selectorTagging,c).find("a:visible").length==0){e(r.selectorTagging,c).hide()}return c}})(jQuery)
// %/