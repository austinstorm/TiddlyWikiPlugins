/***
|''Name''|UntaggedPlugin|
|''Author''|[[Tobias Beer|http://tobibeer.tiddlyspace.com]]|
|''Description''|provides an """<<untagged>>""" macro<br>adds an untagged button to the tags tab<br>allows to hide (empty) tags / tagging|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/UntaggedPlugin.min.js|
|''Documentation''|http://untagged.tiddlyspace.com|
|''Version''|0.9.3 (2013-09-22)|
|''~CoreVersion''|2.5.2|
|''License''|Creative Commons 3.0|
<<option chkShowUntagged>> chkShowUntagged
<<option chkShowUntaggedShadows>> chkShowUntaggedShadows
<<option chkHideEmptyTags>> chkHideEmptyTags
<<option chkHideEmptyTagging>> chkHideEmptyTagging
***/
// /%
(function(e){if(!config.options.chkShowUntagged){config.options.chkShowUntagged=true}if(!config.options.chkShowUntaggedShadows){config.options.chkShowUntaggedShadows=false}if(!config.options.chkHideEmptyTags){config.options.chkHideEmptyTags=true}if(!config.options.chkHideEmptyTagging){config.options.chkHideEmptyTagging=true}merge(config.views.wikified.tag,{untaggedButton:"untagged (%0)",untaggedTooltip:"Show untagged tiddlers...",untaggedListTitle:"Untagged tiddlers:",untaggedNone:"There are no untagged tiddlers..."});var t=config.views.wikified.tag;var n=config.macros.untagged={selectorTags:".tagged, .tidTags, .infoTags",selectorTagging:".tagging, .infoTagging",noTagsWhenTagged:"no-tags",noTaggingWhenTagged:"no-tagging",handler:function(e,t,r,i,s,o){n.refresh(e,s)},refresh:function(r,i){var s,o=[],u,a=i.parseParams("anon",null,true),f=a[0]["anon"]||[],l=f.contains("list"),c=e(r).attr("macroName")=="untagged",h=e(r),p=c?h.parent()[0]:r;if(c)h.hide();store.getTiddlers("title").map(function(e){if(!config.options.chkShowUntaggedShadows&&config.shadowTiddlers[e.title])return true;if(!e.tags||!e.tags.length)o.push(e)});s=e(l?createTiddlyElement(p,"ul"):createTiddlyButton(p,t.untaggedButton.format([o.length]),t.untaggedTooltip,n.showList,"tiddlyLink untagged")).data("tids",o).attr({refresh:"macro",macroName:"untagged",params:i});if(l)n.showList(null,s[0]);else if(f.contains("alltags")){s.appendTo(e("<li/>").appendTo(s.prev()))}if(c){s.insertAfter(h);h.remove()}},showList:function(r,i){var s=r||window.event,o=e(i?i:this).data("tids"),u=i?i:Popup.create(this),a=e(u);a.addClass("taggedTiddlerList untaggedTiddlerList");if(o.length>0){if(i){createTiddlyElement(u,"li",null,"listTitle",t.untaggedListTitle)}else{createTiddlyButton(createTiddlyElement(u,"li"),t.openAllText.format([t.untaggedButton]),t.untaggedTooltip,n.openAll,"tiddlyLink");createTiddlyElement(createTiddlyElement(u,"li",null,"listBreak"),"div")}o.map(function(e){createTiddlyLink(createTiddlyElement(u,"li"),e.title,true)})}else{createTiddlyElement(u,"li",null,"disabled",t.untaggedNone)}a.data("tids",o);if(!i){Popup.show();s.cancelBubble=true;if(s.stopPropagation)s.stopPropagation();return false}},openAll:function(){story.displayTiddlers(this,e(this).closest(".taggedTiddlerList").data("tids"));return false}};config.shadowTiddlers.StyleSheetUntagged="/*{{{*/\n"+".untagged {color:[[ColorPalette::TertiaryDark]];}\n"+"/*}}}*/";store.addNotification("StyleSheetUntagged",refreshStyles);config.macros.allTags.handlerUNTAGGED=config.macros.allTags.handler;config.macros.allTags.handler=function(e,t,n){config.macros.allTags.handlerUNTAGGED.apply(this,arguments);if(config.options.chkShowUntagged){wikify("<<untagged alltags>>",e)}};Story.prototype.displayTiddlerUNTAGGED=Story.prototype.displayTiddler;Story.prototype.displayTiddler=function(t,r,i,s,o,u,a,f){var l=Story.prototype.displayTiddlerUNTAGGED.apply(this,arguments),c=r instanceof Tiddler?r.title:r,h=store.getTiddler(c);if(h&&h.tags&&h.tags.contains(n.noTagsWhenTagged)||config.options.chkHideEmptyTags&&(!h||!h.tags||!h.tags.length)){e(n.selectorTags,l).hide()}if(h&&h.tags&&h.tags.contains(n.noTaggingWhenTagged)||config.options.chkHideEmptyTagging&&(!h||!store.getTaggedTiddlers(c).length)){e(n.selectorTagging,l).hide()}}})(jQuery)
// %/