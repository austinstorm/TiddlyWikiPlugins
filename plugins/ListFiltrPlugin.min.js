/***
|Name|ListFiltrPlugin|
|Author|[[Tobias Beer|http://tobibeer.tiddlyspace.com]]|
|Documentation|http://listfiltr.tiddlyspace.com|
|Source|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/ListFiltrPlugin.min.js|
|Requires||
|~CoreVersion|2.6.5|
|License|Creative Commons 3.0|
|Version|1.1.4 (2013-09-22)|
***/
// /%
(function(e){config.macros.listfiltr={defaultPreserve:"",handler:function(t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v=s.parseParams("anon",null,true),m=getParam(v,"appendTo",this.appendTo),g=getParam(v,"preserve",this.defaultPreserve),y="lf-"+(new Date).formatString("YYYYMMDDhhmmss")+Math.random().toString().substr(6);if(m){h=e(t).closest(".tiddler");t=e(m,h).first()[0]||t}h=e(t).children().last();while(h.is("br"))h=h.prev();if(h.is("span, div"))h=h.contents();h.wrapAll('<div class="lf-list '+y+'"/>');h=e("."+y);if(e.fn.outline)e("ol:not(ol li > ol)",h).outline();e(g,h).addClass("lf-preserve");h.find(":not(iframe)").addBack().contents().filter(function(){var t=e(this);return this.nodeType==3&&(t.prev().is("br")||t.next().is("br"))&&0==t.closest(".lf-preserve").length&&0==t.prevAll(".pseudo-ol-li").length}).wrap('<span class="lf-p"/>');f=e("<div class=lf-search/>").insertBefore(h);a=e("<span class=lf-label/>").html("Filter list:").appendTo(f);u=e('<input type="search"/>').attr({title:"enter your search term here"}).appendTo(f);u.data("list",y).bind("keyup search",function(){var t,n,r,i,s=e(this),o=s.val(),u=s.data("list"),a=e("."+u);o.length>1?a.addClass("lf-filtered"):a.removeClass("lf-filtered");e("li,dd,dt,span,div",a).removeClass("lf-h lf-hide lf-found lf-not").each(function(i){var s,u,a=e(this);if(o.length>1){r=a.clone().children().remove().end().text();t=a.children().not("dl,ol,ul").clone().remove("dl,ol,ul,dl *,ol *,ul *");r=r+" "+t.text();t.each(function(t){var n=e(this),i=n.hasClass("externalLink")?n.attr("href").replace("http://",""):null;tid=n.attr("tiddlyLink");r+=" "+(i?i:"")+(tid?" "+tid:"")});n=r.toLowerCase().indexOf(o.toLowerCase())>-1;a.not("br, .pseudo-ol-li").addClass("lf-"+(n?"found":"h"));if(a.is("dt")){u=a.nextUntil("dt","dd");if(n){u.addClass("lf-not")}}u=a.closest("dd");if(u.length){s=u.prevAll("dt:first");if(n){if(!s.hasClass("lf-found"))s.addClass("lf-not").removeClass("lf-h")}else if(s.hasClass("lf-found")){u.removeClass("lf-h")}}if(n){if(a.is(".listTitle")){console.log(a.parent().find("> li"));a.parent().find("> li").each(function(){var t=e(this);if(!t.hasClass("lf-found"))t.addClass("lf-not")})}p=a.closest("li").parent().find("> .listTitle");if(p.length&&!p.hasClass("lf-found")){p.addClass("lf-not")}}}});e(".highlight:not(.tiddlyLink,.externalLink)",a).each(function(){e(this).after(e(this).text())}).remove();e(".highlight",a).removeClass("highlight");if(o.length>1){e(".lf-found",a).each(function(t){e(this).parentsUntil(i,".lf-h").removeClass("lf-h").not(".pseudo-ol-li").addClass("lf-not");e(".lf-h",this).removeClass("lf-h").not(".pseudo-ol-li").addClass("lf-not")});e.fn.highlight=function(t){var n=new RegExp("(\\b\\w*"+t+"\\w*\\b)","gi"),r='<span class="highlight">$1</span>';this.each(function(){e(this).contents().each(function(){if(this.nodeType===3&&n.test(this.nodeValue)){e(this).replaceWith(this.nodeValue.replace(n,r))}else if(!e(this).hasClass("highlight")){e(this).highlight(t)}})});return this};e("*",a).highlight(o);e(".externalLink, .tiddlyLink",a).each(function(){var t=e(this),n=t.hasClass("tiddlyLink")?t.attr("tiddlylink"):t.attr("href").replace("http://","");if(o.length>1&&n.indexOf(o)>-1)t.addClass("highlight")})}e("dt.lf-not .lf-h, li.lf-not.lf-h",a).removeClass("lf-h");e(".lf-not",a).children().not("ol, ul").find(".lf-h").removeClass("lf-h");e(".lf-h",a).not(".lf-preserve .lf-h").addClass("lf-hide");return true})}};config.shadowTiddlers["StyleSheetListFiltr"]="/*{{{*/\n"+".lf-search {padding:5px;background:#eef;}\n"+".lf-hide {display: none !important;}\n"+".lf-found {background:#F5F5DC;}\n"+".lf-list + br {display:none;}\n"+".lf-label {margin-right:5px;font-weight:bold;}\n"+".lf-filtered .lf-p {display:block;}\n"+".lf-filtered br {display: none;}\n"+".lf-preserve.lf-found br {display: block;}\n"+"/*}}}*/";store.addNotification("StyleSheetListFiltr",refreshStyles)})(jQuery)
//%/