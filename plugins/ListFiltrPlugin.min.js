/***
|Name|ListFiltrPlugin|
|Author|[[Tobias Beer|http://tobibeer.tiddlyspace.com]]|
|Documentation|http://listfiltr.tiddlyspace.com|
|Source|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/ListFiltrPlugin.min.js|
|Requires||
|~CoreVersion|2.6.5|
|License|Creative Commons 3.0|
|Version|1.0.7 (2013-09-04)|
***/
// /%
(function(e){config.macros.listfiltr={defaultPreserve:"",handler:function(t,n,r,i,s,o){var u,a,f,l,c,h,p=s.parseParams("anon",null,true),d=getParam(p,"preserve",this.defaultPreserve),v="lf-"+(new Date).formatString("YYYYMMDDhhmmss")+Math.random().toString().substr(6);c=e(t).children().last();while(c.is("br"))c=c.prev();if(c.is("span,div"))c=c.contents();c.wrapAll('<div class="lf-list '+v+'"/>');c=e("."+v);if(e.fn.outline)e("ol:not(ol li > ol)",c).outline();e(d,c).addClass("lf-preserve");c.find(":not(iframe)").addBack().contents().filter(function(){return this.nodeType==3&&0==e(this).closest("a, span, .lf-preserve").length&&0==e(this).prevAll(".pseudo-ol-li").length}).wrap('<span class="lf-p"/>');f=e("<div class=lf-search/>").insertBefore(c);a=e("<span class=lf-label/>").html("Filter list:").appendTo(f);u=e('<input type="search"/>').attr({title:"enter your search term here"}).appendTo(f);u.data("list",v).bind("keyup search",function(){var t,n,r,i,s=e(this),o=s.val(),u=s.data("list"),a=e("."+u);a.removeClass("lf-filtered");e("li,dd,dt,span,div, br",a).removeClass("lf-h lf-hide lf-found lf-not").each(function(i){var s,u,f=e(this);if(o.length>1){a.addClass("lf-filtered");r=f.clone().children().remove().end().text();t=f.children().not("dl,ol,ul").clone().remove("dl,ol,ul,dl *,ol *,ul *");r=r+" "+t.text();t.each(function(t){var n=e(this),i=n.hasClass("externalLink")?n.attr("href").replace("http://",""):null;tid=n.attr("tiddlyLink");r+=" "+(i?i:"")+(tid?" "+tid:"")});n=r.toLowerCase().indexOf(o.toLowerCase())>-1;f.not("br, .pseudo-ol-li").addClass("lf-"+(n?"found":"h"));if(f.is("dt")){u=f.nextUntil("dd","dt");if(n)u.addClass("lf-not")}if(f.is("dd")){s=f.prevUntil("dt","dt");if(n){if(!s.hasClass("lf-found"))s.addClass("lf-not").removeClass("lf-h")}else if(s.hasClass("lf-found")){f.removeClass("lf-h")}}}});e(".highlight:not(.tiddlyLink,.externalLink)",a).each(function(){e(this).after(e(this).text())}).remove();e(".highlight",a).removeClass("highlight");if(o.length>1){e(".lf-found",a).each(function(t){e(this).parentsUntil(i,".lf-h").removeClass("lf-h").not(".pseudo-ol-li").addClass("lf-not")});e(".lf-found",a).each(function(t){e(".lf-h",this).removeClass("lf-h").not(".pseudo-ol-li").addClass("lf-not")});e.fn.highlight=function(t){var n=new RegExp("(\\b\\w*"+t+"\\w*\\b)","gi"),r='<span class="highlight">$1</span>';this.each(function(){e(this).contents().each(function(){if(this.nodeType===3&&n.test(this.nodeValue)){e(this).replaceWith(this.nodeValue.replace(n,r))}else if(!e(this).hasClass("highlight")){e(this).highlight(t)}})});return this};e("*",a).highlight(o);e(".externalLink, .tiddlyLink",a).each(function(){var t=e(this),n=t.hasClass("tiddlyLink")?t.attr("tiddlylink"):t.attr("href").replace("http://","");if(o.length>1&&n.indexOf(o)>-1)t.addClass("highlight")})}e(".lf-h",a).not(".lf-preserve .lf-h").addClass("lf-hide");return true})}};config.shadowTiddlers["StyleSheetListFiltr"]="/*{{{*/\n"+".lf-search {padding:5px;background:#eef;}\n"+".lf-hide {display: none !important;}\n"+".lf-found {background:#F5F5DC;}\n"+".lf-list + br {display:none;}\n"+".lf-label {margin-right:5px;font-weight:bold;}\n"+".lf-p {display:block;}\n"+".lf-filtered br {display: none;}\n"+".lf-preserve.lf-found br {display: block;}\n"+"/*}}}*/";store.addNotification("StyleSheetListFiltr",refreshStyles)})(jQuery)
//%/