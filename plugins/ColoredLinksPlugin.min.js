/***
|''Name''|ColoredLinksPlugin|
|''Description''|adds color to tiddlyLinks depending on the tag assigned to the corresponding tiddler|
|''Documentation''|http://ColoredLinks.tiddlyspot.com|
|''Version''|1.1.0 (2013-09-25)|
|''Author''|[[TobiasBeer]]|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/ColoredLinksPlugin.min.js|
|''License''|[[Creative Commons Attribution-Share Alike 3.0|http://creativecommons.org/licenses/by-sa/3.0/]]|
/%***/
//{{{
(function(e){var t=config.extensions.coloredLinks={colorTags:true,colorTitles:true,titleSelector:"div.title",excludeTagged:"noColor",color:function(t,n,r){var i,s,o="",u,a,f="",l,c=t,h=config.options;if(r){f=n}else{do{f=c&&c.getAttribute?c.getAttribute("tiddler"):null;o=f?c:o;c=c.parentNode}while(c);f=o?o.getAttribute("tiddler"):""}u=store.getTiddler(f);if(u&&u.tags.containsAny(this.excludeTagged.readBracketedList()))return;u=store.getTiddler(n);if(u&&u.tags){a=0;while(!l&&a<u.tags.length){s=store.getValue(u.tags[a],"tagcolor");l=s?u.tags[a]:"";a++}if(!l)l=u.tags[0]}s=s?s:store.getValue(n,"tagcolor");if(!l&&this.colorTags&&s)l=n;if(s){s=s.replace(/\s*;\s*/g,'","').replace(/\s*:\s*/g,'":"').trim();if(s.substr(s.length-2,2)==',"')s=s.substr(0,s.length-2);s='{"'+s+"}";e(t).css(e.parseJSON(s)).addClass("coloredLink")}if(l)e(t).attr("firsttag",l)}};createTiddlyLink_COLOR=createTiddlyLink;createTiddlyLink=function(e,n,r,i,s,o,u){var a=createTiddlyLink_COLOR.apply(this,arguments);t.color(a,n);return a};createTagButton_COLOR=createTagButton;createTagButton=function(e,n,r,i,s){var o=createTagButton_COLOR.apply(this,arguments);addClass(o,store.getTaggedTiddlers(n).length>0?"hastags":"hasnotags");t.color(o,n);return o};config.macros.allTags.handler_COLOR=config.macros.allTags.handler;config.macros.allTags.handler=function(n,r,i){config.macros.allTags.handler_COLOR.apply(this,arguments);e(".button, .tiddlyLink",n).each(function(n){var r=e(this),i=r.attr("tiddlyLink");if(!i&&r.hasClass("hastags")||r.hasClass("hasnotags"))i=r.attr("tag");if(i)t.color(this,i)})};Story.prototype.refreshTiddler_COLOR=Story.prototype.refreshTiddler;Story.prototype.refreshTiddler=function(n,r,i,s,o){var u=Story.prototype.refreshTiddler_COLOR.apply(this,arguments);if(t.colorTitles)t.color(e(u).find(t.titleSelector)[0],n,true);return u}})(jQuery)
//%/