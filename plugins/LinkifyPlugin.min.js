/***
|''Macro''|LinkifyPlugin|
|''Description''|Automatically linkifies strings, optionally using aliases<br>The plugin is based on Clint Checketts and Paul Petterson's [[RedirectMacro|http://checkettsweb.com/styles/themes.htm#RedirectMacro]]|
|Documentation|http://linkify.tiddlyspot.com|
|''Author''|Tobias Beer|
|''Version''|0.9.6 beta|
|''CoreVersion''|2.5.0|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/LinkifyPlugin.min.js|
|''Usage''|define redirects in LinkifyConfig|
/%***/
(function(e){config.shadowTiddlers.LinkifyConfig="!Exclude\n-excludeLists systemConfig noLinkify\n!Linkify\nLinkifyPlugin|^linkif\n^Tiddler";linkifyHandler=function(e){var t,n=story.findContainingTiddler(e.output),r;n=n?n.getAttribute("tiddler"):"";r=n.indexOf("##");if(r<0)r=n.indexOf("::");if(r>0)n=n.substr(0,r);t=e.source.substr(e.matchStart,1)==config.textPrimitives.unWikiLink;if(t||n&&window.linkifyExcluded.contains(n)){e.outputText(e.output,e.matchStart+(t?1:0),e.nextMatch)}else{e.outputText(createTiddlyLink(createTiddlyElement(e.output,"span",null,"linkified"),this.target,false),e.matchStart,e.nextMatch)}};linkifyAddFormatter=function(e,t,n,r,i){var s,o,u=0,a,f,l,c,h,p,d,v,m=config.formatters,g=e.substr(0,1);if(e.substr(e.length-1,1)=="*"){v=true;e=e.substr(0,e.length-1)}e:while(!s&&['"',"~","^","*","("].contains(g)){switch(g){case"~":if(r)return false;case"^":p=true;break;case'"':s=e.substr(e.length-1,1)=='"';if(s)e=e.substr(0,e.length-1);else break e;break;case"(":d=e.substr(e.length-1,1)==")";if(d){e=e.substr(0,e.length-1)}else{break e}break;case"*":h=true}e=e.substr(1,e.length-1);g=e.substr(0,1)}if(!d)e=e.replace(/\\/mg,"");f="linkify_"+e.replace(/([\W])/mg,function(e){return e.charCodeAt(0)});if(i){l="linkify_"+i.replace(/([\W])/mg,function(e){return e.charCodeAt(0)})}while(u<m.length){o=o||m[u].name==f;if(i&&m[u].name==l){m.splice(u,1)}else u++}if(o||n||!e)return false;c=config.textPrimitives.unWikiLink+"?"+(d?"(?:%2)":"(?:\\b%0%2%1\\b)").format([h?"[\\w]*":"",v?"[\\w]*":"",d?e:e.escapeRegExp().replace(/([a-z]|[A-Z])/img,function(e){return"["+(s?e:/[\W]/mg.exec(e)?"'"+e:e.toUpperCase()+e.toLowerCase())+"]"}).replace(/[\s]/mg,"[\\s]")]);a={name:f,match:c,target:t,handler:linkifyHandler};if(p)m.unshift(a);else m.push(a);return true};linkifyIndexConfig=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h=config.formatters,p=function(e){e=e.replace(/^(\'|\*|\^|\~|\()+/mg,"");return e.replace(/(\*|\))+?/mg,"")};window.linkifyLinkified=[];o=store.getTiddlerText("LinkifyConfig")||store.getShadowTiddlerText("LinkifyConfig");o=o?o.split("\n"):[];for(var d=0;d<h.length;d++){if(h[d].name.indexOf("linkify_")==0){h.splice(d,1);d--}}for(i=0;i<o.length;i++){if(!o[i]||[" ","!"].contains(o[i][0]))continue;s=o[i].split("|");f=p(s[0]);t=0;window.linkifyLinkified.pushUnique(f);for(e=1;e<s.length;e++){u=p(s[e]);if(u.toLowerCase().indexOf(f.toLowerCase())==0){c=s[e];s[e]=s[t];s[t]=c;t=e}}for(e=0;e<s.length;e++)linkifyAddFormatter(s[e],f,false,e==t)}if(window.linkifyAllTiddlers){l=store.getTiddlers();for(a=0;a<l.length;a++){f=l[a].title;linkifyAddFormatter(f,f,window.linkifyExcluded.contains(f)||window.linkifyLinkified.contains(f))}}};linkifyIndexConfig();linkifyIndexExcludes=function(){var e,t="",n,r,r=store.getTiddlerText("LinkifyConfig")||store.getShadowTiddlerText("LinkifyConfig");window.linkifyExcluded=[];r=r?r.split("\n"):[];for(n=0;n<r.length;n++)if(r[n].indexOf("-")==0)t+=r[n].substr(1,r[n].length-1)+" ";t=t.readBracketedList();t.map(function(e){window.linkifyExcluded.pushUnique(e)});for(e=0;e<t.length;e++)store.getTaggedTiddlers(t[e]).map(function(e){window.linkifyExcluded.pushUnique(e.title)})};linkifyIndexExcludes();linkifyTiddlers=function(e){window.linkifyAllTiddlers=e;if(e){linkifyIndexConfig();linkifyIndexExcludes();formatter=new Formatter(config.formatters)}};store.saveTiddler_Linkify=store.saveTiddler;store.saveTiddler=function(e,t){var n=store.saveTiddler_Linkify.apply(this,arguments),r=t;linkifyAddFormatter(r,r,window.linkifyExcluded.contains(r)||window.linkifyLinkified.contains(r),true,r!=e?e:null);if(e=="LinkifyConfig"||t=="LinkifyConfig"){linkifyIndexConfig()}linkifyIndexExcludes();formatter=new Formatter(config.formatters);story.refreshAllTiddlers(true);return n};store.removeTiddler_Linkify=store.removeTiddler;store.removeTiddler=function(e){var t=store.removeTiddler_Linkify.apply(this,arguments);linkifyAddFormatter("*",null,null,null,e);formatter=new Formatter(config.formatters);story.refreshAllTiddlers(true);return t};config.shadowTiddlers.StyleSheetLinkify="/*{{{*/\n"+".linkified .tiddlyLink{color:[[ColorPalette::PrimaryMid]];font-weight:normal;}\n"+".linkified .tiddlyLink:hover{color:[[ColorPalette::PrimaryLight]];background:transparent;}\n"+".headerShadow .linkified .tiddlyLink {color:transparent !important;}\n"+".siteSubtitle .linkified .tiddlyLink{color:[[ColorPalette::PrimaryPale]];background:transparent;}\n"+".siteSubtitle .linkified .tiddlyLink:hover{color:[[ColorPalette::Background]];background:transparent;}\n"+"dt .linkified .tiddlyLink{font-weight:bold;}\n"+"/*}}}*/";store.addNotification("StyleSheetLinkify",refreshStyles)})(jQuery)
//%/