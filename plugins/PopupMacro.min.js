/***
|''Name:''|~PopupMacro|
|''Author:''|Saq Imtiaz (mod: Tobias Beer)|
|''Documentation:''|http://tobibeer.tiddlyspace.com/#PopupMacroMod|
|''Version:''|1.3 TB (2009-09-30)|
|''Description:''|Create popups with custom content|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/PopupMacro.js|
|''Requires:''|TW Version 2.5.3 or better|
/%***/
config.macros.popup = { hover: true, hideAfter: 700, showAfter: 200, fadeTime: 300, err1: "missing macro parameters", err2: "missing label or content parameter", arrow: document.all ? " ▼" : " ▾", handler: function (e, t, n, r, i, s) { var o, u, a, f, l, c = i.parseParams(null, null, true), h = getParam(c, "id", "nestedpopup"), p = "popup popupmacro" + getParam(c, "class", ""), d = getParam(c, "arrow", this.arrow), v = (n.contains("hover") || this.hover) && (!n.contains("nohover") || !this.hover), m = "btn" + (new Date).formatString("YYYYMMDDhhmmss") + Math.random().toString().substr(6); if (!n[0] || !n[1]) { createTiddlyError(e, this.err1, this.err2); return false } u = n[0]; a = n[1].replace(/\$\)\)/g, ">>"); o = createTiddlyButton(e, u + d, u, this.show, "button popupbutton", m, null, { open: "true", popupclass: p, content: a }); o.setAttribute("popupid", !isNested(o) ? h : "popup"); o.onmouseover = v ? this.showAfter ? this.delay : this.show : null; o.onmouseout = v && this.showAfter ? this.abort : null }, close: function (e) { if (e.getAttribute("close") == "ok") { } }, mouseout: function () { var e = config.macros.popup, t = this; t.setAttribute("close", "ok"); setTimeout(function () { e.close(t) }, e.hideAfter) }, mouseover: function () { this.setAttribute("close", "") }, delay: function (e) { var t = this, n = config.macros.popup; t.setAttribute("abort", ""); setTimeout(function () { n.show(t) }, n.showAfter) }, abort: function (e) { var t = config.macros.popup; this.setAttribute("abort", "true"); var n = document.getElementById(this.getAttribute("popupid")); if (n) { n.setAttribute("close", "ok"); setTimeout(function () { t.close(n) }, t.hideAfter) } }, show: function (e) { var t, n, r, i, s = config.macros.popup, o = this.innerHTML ? this : e; btnId = o.getAttribute("id"), id = o.getAttribute("popupid"), cls = o.getAttribute("popupclass"), src = o.getAttribute("content"); e = e || window.event; if (o.getAttribute("abort") == "true") return; t = o.getAttribute("open") == "true"; o.setAttribute("open", !t); if (t) { i = this.innerHTML ? resolveTarget(e || window.event) : o; if (n && Popup.stack.length > 1) Popup.removeFrom(1); else if (!n && Popup.stack.length > 0) Popup.removeFrom(0); r = createTiddlyElement(document.body, "ol", id, cls, null); r.onmouseover = s.mouseover; r.onmouseout = s.mouseout; Popup.resetButtonShow(); Popup.showButtonId = btnId; Popup.stack.push({ root: o, popup: r }); wikify(src, r); Popup.show(r, true); if (e) { e.cancelBubble = true; if (e.stopPropagation) e.stopPropagation() } return false } } }; window.isNested = function (e) { var t = document.getElementById("contentWrapper"); while (e != null) { if (e == t) return true; e = e.parentNode } return false }; Popup.resetButtonShow = function () { var e = document.getElementById(Popup.showButtonId); if (e) { e.setAttribute("open", "true"); Popup.showButtonId = "" } }; if (!Popup.macroRemove) Popup.macroRemove = Popup.remove; Popup.remove = function (e) { Popup.resetButtonShow(); Popup.macroRemove.apply(this, arguments) }; setStylesheet("#nestedpopup {margin-left:1em;}.popupbutton{cursor:pointer};", "PopupMacroStyles")
//}%/