/***
|''Name''|PagrPlugin|
|''Description''|Simple prev / next / to toc navigation based on a fixed ToC|
|''Documentation''|http://pagr.tiddlyspace.com|
|''Author''|Tobias Beer|
|''~CoreVersion''|2.5.3|
|''Version''|0.5.2 (2013-09-24)|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/PagrPlugin.min.js|
|''License''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
***/
// /%
(function(e){var t=config.macros.pagr={fmtNext:"[[%0]]",fmtHome:"[[▲|%0]]",fmtPrev:"[[%0]]",toc:"",handler:function(n,r,i,s,o,u){var a,f,l="",c,h={},p,d,v,m,g,y,b,w=o.parseParams("anon",null,true),E=i.contains("sub");["fmtPrev|p","fmtHome|h","fmtNext|n","toc"].map(function(e){e=e.split("|");h[e[1]?e[1]:e[0]]=getParam(w,e[0],t[e[0]])});a=store.getTiddlerText(h.toc);m=story.findContainingTiddler(n);m=m?m.getAttribute("tiddler"):"";if(!m||!a)return;d=h.toc.indexOf("##");h.toc=h.toc.substr(0,d>0?d:h.toc.length);y=e("<div/>");wikify(a,y[0]);E=getParam(w,"sub",E?m:"");if(E){c=y.find('[tiddlyLink="'+E+'"]').first().next("ol,ul");if(c.closest(".pseudo-ol").length)c.addClass("pseudo-ol");c.appendTo(n);return}g=[];e(".tiddlyLink",y).each(function(){g.push(e(this).attr("tiddlyLink"))});d=g.indexOf(m);if(d<0)return;p=d-1<0?-1:d-1;next=d+1>=g.length?0:d+1;v=createTiddlyElement(n,"div",null,"pagr");if(h.p&&p>=0)l+="{{pagr_prev{"+h.p.format([g[p]])+"}}}";if(h.h)l+=h.h.format([h.toc]);if(h.n&&next)l+="{{pagr_next{"+h.n.format([g[next]])+"}}}";wikify(l,v)}};config.shadowTiddlers.StyleSheetPagr="/*{{{*/\n"+".pagr {margin: 0 0 0.5em 1em;}\n"+".pagr a {padding:5px;}\n"+'.pagr_prev a:before {content:"« ";}\n'+'.pagr_next a:after {content:" »";}\n'+"/*}}}*/";store.addNotification("StyleSheetPagr",refreshStyles)})(jQuery)
// %/