/***
|''Name''|FindrPlugin|
|''Description''|display search results in a list with more flexibility|
|''Documentation''|http://findr.tiddlyspace.com|
|''Authors''|Tobias Beer|
|''Version''|1.0.0 (2013-10-10)|
|''CoreVersion''|2.5.2|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/FindrPlugin.min.js|
|''License''|[[Creative Commons Attribution-ShareAlike 3.0 License|http://creativecommons.org/licenses/by-sa/3.0/]]|
***/
///%
(function(e){var t=config.extensions.findr={where:"",fallback:"#displayArea",how:"prependTo",hide:"",empty:false,listfiltr:true,id:"searchResults",idClose:"search_close",idOpenAll:"search_open",fmtHeader:"\n!Search Results",fmtMessage:"\n''%0''",fmtItem:"\n* [[%0]]",fmtItems:"\n{{search_list{%0\n}}}\n",fmtQuery:"'%0'",fmtRegExp:"/%0/",btnCloseLabel:"close",btnCloseTooltip:"dismiss search results",btnOpenLabel:"open all",btnOpenTooltip:"open all search results",displayResults:function(n,r,i){var s,o,u,a="",f=e(t.where).first();e("#"+t.id).remove();story.refreshAllTiddlers(true);r='"""%0"""'.format(t[i?"fmtQuery":"fmtRegExp"].format(i?t.fmtRegExp.format(r):r));e(t.hide).hide();if(!f.length)f=e(t.fallback);if(t.empty)f.empty();el=e("<div/>").attr("id",t.id);switch(t.how){case"insertAfter":el.insertAfter(f);break;case"insertBefore":el.insertBefore(f);break;case"appendTo":el.appendTo(f);break;default:el.prependTo(f)}el=el[0];if(n.length>0){o=t.fmtMessage.format(config.macros.search.successMsg.format([n.length.toString(),r]));t.results=[];n.map(function(e){t.results.push(e.title);a+=t.fmtItem.format(e.title)})}else{o=t.fmtMessage.format(config.macros.search.failureMsg.format([r]))}s=createTiddlyElement(el,"div","findrButtons");createTiddlyButton(s,t.btnCloseLabel,t.btnCloseTooltip,t.closeResults,"button",t.idClose);if(n.length>0){createTiddlyButton(s,t.btnOpenLabel,t.btnOpenTooltip,t.openAll,"button",t.idOpenAll)}u=t.fmtHeader+o+t.fmtItems.format(a)+(t.listfiltr&&config.macros.listfiltr?"<<listfiltr>>":"");wikify(u,el)},closeResults:function(){e(t.hide).show();var n=e("#"+t.id),r=n.closest('[refresh="content"]')[0];if(r)config.refreshers.content(r);n.remove();t.results=null;highlightHack=null},openAll:function(e){story.displayTiddlers(null,t.results);return false}};Story.prototype.search=function(e,n,r){highlightHack=new RegExp(r?e:e.escapeRegExp(),n?"mg":"img");t.displayResults(store.search(highlightHack,null,"excludeSearch"),e,r)};TiddlyWiki.prototype.search=function(e,t,n,r){var i,s=[[],[],[]],i=this.reverseLookup("tags",n,!!r);if(t){i.sort(function(e,n){return;e[t]<n[t]?-1:e[t]==n[t]?0:+1})}else{i.map(function(t){if(-1!=t.title.search(e)){s[0].push(t)}else if(-1!=t.tags.join(",").search(e)){s[1].push(t)}else if(-1!=t.text.search(e)){s[2].push(t)}});i=s[0].concat(s[1]).concat(s[2])}return i}})(jQuery)
//%/