/***
|''Name:''|TypeWithMePlugin|
|''Description:''|Provides a toolbar button that lets you create [[etherpad-style|http://de.wikipedia.org/wiki/EtherPad]] documents for any tiddler|
|''Documentation:''|http://tobibeer.tiddlyspace.com/#TypeWithMe|
|''Version:''|0.9.3 (2013-03-05)|
|''Status:''|stable|
|''Author:''|[[Tobias Beer]]|
|''Source''|https://raw.github.com/tobibeer/TiddlyWikiPlugins/master/plugins/TypeWithMePluginSource.min.js|
|''~CoreVersion:''|Version 2.5.3 or better|
***/
//{{{
(function(e){
config.commands.typeWithMe={

serviceURL: 'http://willyou.typewith.me/p/%0',
target: '_blank',
inline: true,
iframe: '<html><a href="%0" target="_blank" class="externalLink" style="margin-left:1em;">open pad in new window</a><iframe src="%0" class="frmTypeWithMe"/></html>',
fmtPrefix: '%date',
fmtDate: 'YYYY-0MM-0DD',
text: 'discuss',
tooltip: 'show typewith.me discussion',

handler:function(t,n,r){var i,s=config.commands.typeWithMe,o=t||window.event,u=story.getTiddler(r),a=config.extensions.tiddlyspace,f=store.getTiddler(r),l=[s.fmtPrefix.replace(/%date/,(new Date).formatString(s.fmtDate)),r],c=store.getValue(r,"typewithme");if(a)l.unshift(a.currentSpace.name);l=l.join("-").replace(/\s/mg,"-");if(!f||!c){store.saveTiddler(r,r,f?f.text:"",f?f.modifier:config.options.txtUserName,f?f.modified:new Date,f?f.tags:"",merge({typewithme:l},f?f.fields:config.defaultCustomFields));if(config.options.chkAutoSave)autoSaveChanges();}else l=c;url=s.serviceURL.format([l]);if(!o.ctrlKey&&s.inline){i=e(".frmTypeWithMe",u);if(i[0])i.parent().parent().remove();else{i=e('<span/>').insertBefore(e(u).find(".viewer").first());wikify(s.iframe.format([url]),i[0])}}else window.open(url,s.target)}}})(jQuery)
//}}}